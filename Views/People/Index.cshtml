@model IEnumerable<mvcApp.Models.Person>

@{
    ViewData["Title"] = "Staff Management";
}

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function clearForm() {
            $('#Id').val('');
            $('#Name').val('');
            $('#Title').val('');
            $('#Email').val('');
            $('#Adress').val('');
            $('#submitBtn').text("Add");
        }

        function refresh() {
            $.get('/People/GetPeoplePartial', function (data) {
                $('#peopleTableBody').html(data);
            });
        }

        function fillForm(id, name, title, email, adress) {
            $('#Id').val(id);
            $('#Name').val(name);
            $('#Title').val(title);
            $('#Email').val(email);
            $('#Adress').val(adress); 
            $('#submitBtn').text("Update");
        }

        function deletePerson(id) {
            if (confirm("Are you sure you want to delete?")) {
                $.post('/People/Delete/' + id, function () {
                    refresh();
                    clearForm();
                });
            }
        }

        $(function () {
            $('#personForm').submit(function (e) {
                e.preventDefault();

                const idVal = parseInt($('#Id').val());
                const url = isNaN(idVal) || idVal === 0 ? '/People/Create' : '/People/Edit';

                $.ajax({
                    type: 'POST',
                    url: url,
                    data: $(this).serialize(),
                    success: function () {
                        clearForm();
                        refresh();
                    },
                    error: function (xhr) {
                        alert("Hata: " + xhr.responseText);
                    }
                });
            });

            $('table').on('click', '.edit-btn', function () {
                const row = $(this).closest('tr');
                fillForm(
                    row.data('id'),
                    row.find('.person-name').text(),
                    row.find('.person-title').text(),
                    row.find('.person-email').text(),
                    row.find('.person-adress').text()
                );
            });

            $('table').on('click', '.delete-btn', function () {
                const id = $(this).closest('tr').data('id');
                deletePerson(id);
            });
        });
    </script>
}

<h2>@ViewData["Title"]</h2>

<form id="personForm">
    <input type="hidden" id="Id" name="Id" />

    <div class="form-group">
        <label>Name</label>
        <input type="text" class="form-control" id="Name" name="Name" required />
    </div>

    <div class="form-group">
        <label>Title</label>
        <input type="text" class="form-control" id="Title" name="Title" />
    </div>

    <div class="form-group">
        <label>Email</label>
        <input type="email" class="form-control" id="Email" name="Email" />
    </div>

    <div class="form-group">
        <label>Address</label>
        <input type="text" class="form-control" id="Adress" name="Adress" />
    </div>

    <br />
    <button type="submit" class="btn btn-success" id="submitBtn">Add</button>
    <button type="button" class="btn btn-secondary" onclick="clearForm()">Clean</button>
    <button type="button" class="btn btn-info" onclick="refresh()">Refresh</button>
</form>

<hr />

<table class="table table-bordered">
    <thead>
        <tr>
            <th>Name</th>
            <th>Title</th>
            <th>Email</th>
            <th>Address</th>
            <th>Functions</th>
        </tr>
    </thead>
    <tbody id="peopleTableBody">
        @foreach (var item in Model)
        {
            <tr data-id="@item.Id">
                <td class="person-name">@item.Name</td>
                <td class="person-title">@item.Title</td>
                <td class="person-email">@item.Email</td>
                <td class="person-adress">@item.Adress</td>
                <td>
                    <button type="button" class="btn btn-primary btn-sm edit-btn">Edit</button>
                    <button type="button" class="btn btn-danger btn-sm delete-btn">Delete</button>
                </td>
            </tr>
        }
    </tbody>
</table>

<form asp-controller="Account" asp-action="Logout" method="post">
    <button type="submit" class="btn-danger">Logout</button>
</form>
